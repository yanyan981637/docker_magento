# upstream 定義 PHP-FPM
upstream fastcgi_backend {
    server magento-php:9000;
}

# HTTP 配置: 重定向所有 HTTP 請求到 HTTPS
server {
    listen 80;
    server_name test-themeb2b.mio.com;

    # 將所有 HTTP 請求重定向到 HTTPS
    return 301 https://$host$request_uri;
}

# HTTPS 配置
server {
    listen 443 ssl http2;
    server_name test-themeb2b.mio.com;

    # SSL 設定
    ssl_certificate /etc/nginx/ssl/wildcard.mio.com.pem;
    ssl_certificate_key /etc/nginx/ssl/wildcard.mio.com.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    # 設置最大請求大小
    client_max_body_size 256M;

    # 定義 Magento 根目錄
    set $MAGE_ROOT /data/enterprise;

    # 包含 Magento Nginx 樣板設定
    include /data/enterprise/nginx.conf.sample;

    # 日誌設定 (可選)
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
}
